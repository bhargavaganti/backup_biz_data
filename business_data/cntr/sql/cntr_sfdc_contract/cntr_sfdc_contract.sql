WITH cntr_sfdc_contracts AS
(
select
row_number() OVER (PARTITION BY id ORDER BY systemmodstamp_mst DESC ) AS row_number_seq,
accountid,
asset_type__c,
auto_renewal__c,
auto_renewal_status__c,
billing_period__c,
bop_code__c,
broker_plan_affiliation__c,
contract_term__c,
contractedamlc__c,
contractedimpressions__c,
createddate_mst,
credit_amount__c_double,
credit_status__c,
daily_contract_value__c_double,
daily_rate__c_double,
daily_rate_on_asset__c_double,
days__c_double,
description,
discount_type__c,
email__c,
end_date__c_mst,
est_tax__c_double,
est_total_tax__c_double,
expired_date__c_mst,
ext_days__c,
extended_end_date__c_mst,
extended_net_price__c_double,
extension_type__c,
external_id__c,
free_extension__c,
fulfilled_zip_list__c,
fulfillment_required__c,
fulfillment_status__c,
fulfillment_status_notes__c,
hlc__c_double,
hlc_override__c_double,
id,
inactivation_date__c_mst,
inventory_reference_id__c,
inventory_status__c,
is_inactive__c,
iscompetitorproduct,
isdeleted,
landamlc__c,
landamlcoverride__c,
lastmodifieddate_mst,
lastreferenceddate_mst,
lead_type__c,
legacy_product__c,
legacy_siebel_asset_id__c,
legacy_siebel_order_id__c,
license_id__c,
license_keywords__c,
license_level__c,
license_name__c,
license_primary_city__c,
license_sale_type__c,
license_state__c,
license_tier__c,
license_tier_range__c,
line_type__c,
list_price__c,
manual_discount__c_double,
manual_discount_type__c,
manual_override_amount__c,
manual_price_override__c_double,
market__c,
market_code__c,
market_tier__c,
market_zip__c,
mls_set__c,
mls_set_id__c,
mls_type__c,
msa_tier__c,
name,
nar_membership__c,
net_price__c_double,
original_total_net_ods__c,
parent_asset__c,
price,
product2id,
product_type__c,
promotion__c_double,
promotion_amount__c_double,
purchasedate_mst,
quantity,
remaining_amount__c_double,
renewal_status__c,
start_date__c_mst,
status,
systemmodstamp_mst,
team__c,
term_end_date__c_mst,
term_start_date__c_mst,
total_credit__c,
total_discount__c_double,
total_discount_percent__c_double,
total_list_price__c_double,
total_net__c_double,
total_net_monthly__c,
total_net_price__c,
total_price_withtax__c_double,
ultimate_parent__c,
ultimate_parent_asset_name__c
from
cntr_contract_pdt__es_dm_sfdc_asset_vw
)
SELECT
cntr_sfdc_contracts.accountid account_id ,
cntr_sfdc_contracts.asset_type__c asset_type ,
cntr_sfdc_contracts.auto_renewal__c auto_renewal ,
cntr_sfdc_contracts.auto_renewal_status__c auto_renewal_status ,
cntr_sfdc_contracts.billing_period__c billing_period ,
cntr_sfdc_contracts.bop_code__c bop_code ,
cntr_sfdc_contracts.broker_plan_affiliation__c broker_plan_affiliation ,
cntr_sfdc_contracts.contract_term__c contract_term ,
cntr_sfdc_contracts.contractedamlc__c contracted_amlc ,
cntr_sfdc_contracts.contractedimpressions__c contracted_impressions ,
cntr_sfdc_contracts.createddate_mst created_date ,
cntr_sfdc_contracts.credit_amount__c_double credit_amount ,
cntr_sfdc_contracts.credit_status__c credit_status ,
cntr_sfdc_contracts.daily_contract_value__c_double daily_contract_value ,
cntr_sfdc_contracts.daily_rate__c_double daily_rate ,
cntr_sfdc_contracts.daily_rate_on_asset__c_double daily_rate_on_asset ,
cntr_sfdc_contracts.days__c_double days ,
cntr_sfdc_contracts.description description ,
cntr_sfdc_contracts.discount_type__c discount_type ,
cntr_sfdc_contracts.email__c email ,
cntr_sfdc_contracts.end_date__c_mst end_date ,
cntr_sfdc_contracts.est_tax__c_double est_tax ,
cntr_sfdc_contracts.est_total_tax__c_double est_total_tax ,
cntr_sfdc_contracts.expired_date__c_mst expired_date ,
cntr_sfdc_contracts.ext_days__c ext_days ,
cntr_sfdc_contracts.extended_end_date__c_mst extended_end_date ,
cntr_sfdc_contracts.extended_net_price__c_double net_monthly_price ,
cntr_sfdc_contracts.extension_type__c extension_type ,
cntr_sfdc_contracts.external_id__c contract_number ,
cntr_sfdc_contracts.free_extension__c free_extension ,
cntr_sfdc_contracts.fulfilled_zip_list__c fulfilled_zip_list ,
cntr_sfdc_contracts.fulfillment_required__c fulfillment_required ,
cntr_sfdc_contracts.fulfillment_status__c fulfillment_status ,
cntr_sfdc_contracts.fulfillment_status_notes__c fulfillment_status_notes ,
cntr_sfdc_contracts.hlc__c_double hlc ,
cntr_sfdc_contracts.hlc_override__c_double hlc_override ,
cntr_sfdc_contracts.id asset_id ,
cntr_sfdc_contracts.inactivation_date__c_mst cancellation_date ,
cntr_sfdc_contracts.inventory_reference_id__c inventory_reference_id ,
cntr_sfdc_contracts.inventory_status__c inventory_status ,
cntr_sfdc_contracts.is_inactive__c is_inactive ,
cntr_sfdc_contracts.iscompetitorproduct is_competitor_product ,
cntr_sfdc_contracts.isdeleted is_deleted ,
cntr_sfdc_contracts.landamlc__c land_amlc ,
cntr_sfdc_contracts.landamlcoverride__c land_amlc_override ,
cntr_sfdc_contracts.lastmodifieddate_mst last_modified_date ,
cntr_sfdc_contracts.lastreferenceddate_mst last_referenced_date ,
cntr_sfdc_contracts.lead_type__c lead_type ,
cntr_sfdc_contracts.legacy_product__c legacy_product ,
cntr_sfdc_contracts.legacy_siebel_asset_id__c siebel_asset_id ,
cntr_sfdc_contracts.legacy_siebel_order_id__c siebel_order_id ,
cntr_sfdc_contracts.license_id__c license_id ,
cntr_sfdc_contracts.license_keywords__c license_keywords ,
cntr_sfdc_contracts.license_level__c license_level ,
cntr_sfdc_contracts.license_name__c license_name ,
cntr_sfdc_contracts.license_primary_city__c license_primary_city ,
cntr_sfdc_contracts.license_sale_type__c license_sale_type ,
cntr_sfdc_contracts.license_state__c license_state ,
cntr_sfdc_contracts.license_tier__c license_tier ,
cntr_sfdc_contracts.license_tier_range__c license_tier_range ,
cntr_sfdc_contracts.line_type__c line_type ,
cntr_sfdc_contracts.list_price__c list_price ,
cntr_sfdc_contracts.manual_discount__c_double manual_discount ,
cntr_sfdc_contracts.manual_discount_type__c manual_discount_type ,
cntr_sfdc_contracts.manual_override_amount__c manual_override_amount ,
cntr_sfdc_contracts.manual_price_override__c_double manual_price_override ,
cntr_sfdc_contracts.market__c market ,
cntr_sfdc_contracts.market_code__c market_code ,
cntr_sfdc_contracts.market_tier__c market_tier ,
cntr_sfdc_contracts.market_zip__c market_zip ,
cntr_sfdc_contracts.mls_set__c mls_set ,
cntr_sfdc_contracts.mls_set_id__c mls_set_id ,
cntr_sfdc_contracts.mls_type__c mls_type ,
cntr_sfdc_contracts.msa_tier__c msa_tier ,
cntr_sfdc_contracts.name name ,
cntr_sfdc_contracts.nar_membership__c nar_membership ,
cntr_sfdc_contracts.net_price__c_double net_price ,
cntr_sfdc_contracts.original_total_net_ods__c original_total_net_contract_value ,
cntr_sfdc_contracts.parent_asset__c parent_asset_id ,
cntr_sfdc_contracts.price rate_card ,
cntr_sfdc_contracts.product2id product2id ,
cntr_sfdc_contracts.product_type__c product_type ,
cntr_sfdc_contracts.promotion__c_double promotion_code ,
cntr_sfdc_contracts.promotion_amount__c_double promotion_amount ,
cntr_sfdc_contracts.purchasedate_mst purchase_date ,
cntr_sfdc_contracts.quantity quantity ,
cntr_sfdc_contracts.remaining_amount__c_double remaining_amount ,
cntr_sfdc_contracts.renewal_status__c renewal_status ,
cntr_sfdc_contracts.start_date__c_mst start_date ,
cntr_sfdc_contracts.status status ,
cntr_sfdc_contracts.systemmodstamp_mst systemmodstamp ,
cntr_sfdc_contracts.team__c team ,
cntr_sfdc_contracts.term_end_date__c_mst term_end_date ,
cntr_sfdc_contracts.term_start_date__c_mst term_start_date ,
cntr_sfdc_contracts.total_credit__c total_credit ,
cntr_sfdc_contracts.total_discount__c_double total_discount ,
cntr_sfdc_contracts.total_discount_percent__c_double total_discount_percent ,
cntr_sfdc_contracts.total_list_price__c_double total_list_price ,
cntr_sfdc_contracts.total_net__c_double total_net ,
cntr_sfdc_contracts.total_net_monthly__c total_net_monthly ,
cntr_sfdc_contracts.total_net_price__c total_net_price ,
cntr_sfdc_contracts.total_price_withtax__c_double total_price_withtax ,
cntr_sfdc_contracts.ultimate_parent__c ultimate_parent_asset_id ,
cntr_sfdc_contracts.ultimate_parent_asset_name__c ultimate_parent_asset_name ,

cntr_sfdc_sold_to_accounts.account_name sold_to_account_name,
cntr_sfdc_sold_to_accounts.account_id sold_to_account_id,
cntr_sfdc_sold_to_accounts.account_type sold_to_account_type,
cntr_sfdc_sold_to_accounts.mls_set_id sold_to_account_mls_set_id,
cntr_sfdc_sold_to_accounts.cdh_party_id sold_to_account_cdh_party_id,
cntr_sfdc_fullfil_to_accounts.account_name fullfil_to_account_name,
cntr_sfdc_fullfil_to_accounts.account_id fullfil_to_account_id,
cntr_sfdc_fullfil_to_accounts.account_type fullfil_to_account_type,
cntr_sfdc_fullfil_to_accounts.mls_set_id fullfil_to_account_mls_set_id,
cntr_sfdc_fullfil_to_accounts.cdh_party_id fullfil_to_account_cdh_party_id,
cntr_sfdc_products.product_code product_code

FROM cntr_sfdc_contracts
left join cntr_sfdc_accounts cntr_sfdc_sold_to_accounts ON cntr_sfdc_contracts.accountid=cntr_sfdc_sold_to_accounts.account_id AND cntr_sfdc_contracts.parent_asset__c IS NULL
left join cntr_sfdc_accounts cntr_sfdc_fullfil_to_accounts ON cntr_sfdc_contracts.accountid=cntr_sfdc_fullfil_to_accounts.account_id
left join cntr_sfdc_products ON cntr_sfdc_contracts.product2id=cntr_sfdc_products.product_id
WHERE cntr_sfdc_contracts.row_number_seq = 1
