WITH edw_listings AS
(
select
row_number() OVER (PARTITION BY listingdimkey ORDER BY  effectiveto_datetime_mst ASC) AS row_number_seq,
listingdimkey ,
listingid ,
buyeragentofficedatasourceid ,
buyeragentsourcealiasid ,
buyercoagentofficedatasourceid ,
buyercoagentsourcealiasid ,
buyercoofficesourcealiasid ,
buyerofficesourcealiasid ,
createdby ,
createddate ,
dapendingdate ,
dapendingflag ,
effectivefrom ,
effectiveto ,
etl_create_date ,
etl_source_filename ,
etl_ztg_id ,
fulfillmentgroupbitmask ,
hascobroke ,
hascobrokephone ,
headline2 ,
headline ,
isaolsyndication ,
ischoiceenabled ,
isdisplayed ,
isforeclosure ,
isopenhouse ,
ispricedropped ,
ispriceincreased ,
isrdcsyndication ,
isrental ,
isvideo ,
isvirtualtour ,
listingaddress ,
listingagentofficedatasourceid ,
listingagentsourcealiasid ,
listingcity ,
listingcoagentofficedatasourceid ,
listingcoagentsourcealiasid ,
listingcoofficesourcealiasid ,
listingcountry ,
listingcounty ,
listingcurrentprice ,
listingdatasourceid ,
listingenddate ,
listinggeoapproximation ,
listinglotsquarefeet ,
listingmarketingtype ,
listingnumberofbathrooms ,
listingnumberofbedrooms ,
listingnumberofstories ,
listingofficesourcealiasid ,
listingoriginalprice ,
listingpercentagecompleteness ,
listingphotocount ,
listingphotourl ,
listingpostalcode ,
listingpriceincreaseddate ,
listingpricereduceddate ,
listingprovider ,
listingrawstatus ,
listingrentalprice ,
listingsolddate ,
listingsoldprice ,
listingsourcealiasid ,
listingsquarefeet ,
listingstartdate ,
listingstate ,
listingstatus ,
listingstatuschangeddate ,
listingstyle ,
listingtype ,
masterplanid ,
modifiedby ,
modifieddate ,
newconstructionflag ,
nonmlsflag ,
openhouseenddate ,
openhousestartdate ,
producttypedimkey ,
propertydescription ,
propertyid ,
specialmessage ,
specid ,
systemcreationdate ,
udblistingid
from
listing_dim_All
)
SELECT
listingdimkey ,
listingid ,
buyeragentofficedatasourceid ,
buyeragentsourcealiasid ,
buyercoagentofficedatasourceid ,
buyercoagentsourcealiasid ,
buyercoofficesourcealiasid ,
buyerofficesourcealiasid ,
createdby ,
createddate ,
dapendingdate ,
dapendingflag ,
effectivefrom ,
effectiveto ,
etl_create_date ,
etl_source_filename ,
etl_ztg_id ,
fulfillmentgroupbitmask ,
hascobroke ,
hascobrokephone ,
headline2 ,
headline ,
isaolsyndication ,
ischoiceenabled ,
isdisplayed ,
isforeclosure ,
isopenhouse ,
ispricedropped ,
ispriceincreased ,
isrdcsyndication ,
isrental ,
isvideo ,
isvirtualtour ,
listingaddress ,
listingagentofficedatasourceid ,
listingagentsourcealiasid ,
listingcity ,
listingcoagentofficedatasourceid ,
listingcoagentsourcealiasid ,
listingcoofficesourcealiasid ,
listingcountry ,
listingcounty ,
listingcurrentprice ,
listingdatasourceid ,
listingenddate ,
listinggeoapproximation ,
listinglotsquarefeet ,
listingmarketingtype ,
listingnumberofbathrooms ,
listingnumberofbedrooms ,
listingnumberofstories ,
listingofficesourcealiasid ,
listingoriginalprice ,
listingpercentagecompleteness ,
listingphotocount ,
listingphotourl ,
listingpostalcode ,
listingpriceincreaseddate ,
listingpricereduceddate ,
listingprovider ,
listingrawstatus ,
listingrentalprice ,
listingsolddate ,
listingsoldprice ,
listingsourcealiasid ,
listingsquarefeet ,
listingstartdate ,
listingstate ,
listingstatus ,
listingstatuschangeddate ,
listingstyle ,
listingtype ,
masterplanid ,
modifiedby ,
modifieddate ,
newconstructionflag ,
nonmlsflag ,
openhouseenddate ,
openhousestartdate ,
producttypedimkey ,
propertydescription ,
propertyid ,
specialmessage ,
specid ,
systemcreationdate ,
udblistingid,
to_date(effectiveto) AS effectiveto_date
FROM edw_listings WHERE row_number_seq = 1